# Запрос: Очистка кода от LLM-чанкера (v0.26)

## Задача

Удалить устаревший код LLM-чанкера после перехода на детерминистический H2-чанкинг.
Цель — чистая архитектура без мёртвого кода и устаревших настроек.

## Контекст

В v0.25 реализован детерминистический чанкинг:
- Новый файл: `backend/app/utils/h2_chunker.py` — regex парсинг H2 заголовков
- Старый LLM-чанкер (`backend/app/services/chunker.py`) больше не используется
- Pipeline: `Clean → Longread/Story → Summary → Chunk (H2) → Save`

См. общий план: [docs/research/pipeline-optimization-for-rag.md](../research/pipeline-optimization-for-rag.md)

## Что нужно сделать

### 1. Удалить файлы

```
backend/app/services/chunker.py  # Весь файл — старый LLM-чанкер
```

### 2. Удалить настройки

**backend/app/config.py:**
```python
# Удалить эту строку из Settings:
chunker_model: str = "gemma2:9b"
```

**docker-compose.yml:**
```yaml
# Удалить эту переменную:
CHUNKER_MODEL: "gemma2:9b"
```

### 3. Очистить config/models.yaml

Удалить секции `chunker` из всех моделей:

```yaml
# Удалить из gemma2, qwen2, qwen3 и т.д.:
chunker:
  min_chunk_words: 100
  target_chunk_words: 300
```

### 4. Обновить код

**backend/app/services/pipeline/config_resolver.py:**
- Удалить `chunker` из методов resolve

**backend/app/api/cache_routes.py:**
- Проверить и удалить `chunker`/`CHUNKING` из cache stages если есть

**backend/app/models/cache.py:**
- Удалить `CHUNKING` из `CacheStageName` enum если есть

### 5. Обновить документацию

**CLAUDE.md:**
- Удалить `CHUNKER_MODEL` из таблицы настроек
- Удалить chunker из таблицы моделей

**docs/configuration.md:**
- Удалить `CHUNKER_MODEL` из списка env переменных

**docs/model-testing.md:**
- Удалить секции про тестирование чанкера

## Проверка после очистки

```bash
# Поиск оставшихся упоминаний
grep -r "chunker_model" backend/
grep -r "chunker" config/models.yaml
grep -r "CHUNKER_MODEL" .
grep -r "from app.services.chunker" backend/
grep -r "from app.services import chunker" backend/

# Проверить что импорты не сломались
cd backend && python -c "from app.main import app; print('OK')"

# Тесты если есть
python -m pytest backend/tests/ -v
```

## Ожидаемый результат

- ✅ Удалён `chunker.py` (~300 строк)
- ✅ Удалена переменная `CHUNKER_MODEL`
- ✅ Очищен `config/models.yaml`
- ✅ Обновлена документация
- ✅ Версия обновлена до 0.26.0
- ✅ Чистая архитектура без мёртвого кода
