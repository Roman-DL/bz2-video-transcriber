# ADR-012: Вкладка "Статистика" для отображения метрик обработки

## Статус

Принято (v0.58)

## Контекст

Метрики обработки (время, токены, стоимость) отображались разрозненно:
- В карточке завершения (CompletionCard) — дублирование
- В заголовках вкладок — частичная информация
- Нет единого места для просмотра всей статистики

Это затрудняло анализ стоимости обработки и отладку pipeline.

## Решение

Создать вкладку "Статистика" (`StatisticsView`) с централизованным отображением метрик:

### Компоненты

```
frontend/src/components/results/StatisticsView.tsx  — основной компонент
frontend/src/components/processing/CompletionCard.tsx — упрощён (без метрик)
```

### Отображаемые данные

1. **Карточки сводки** (3 колонки):
   - Общее время обработки
   - Токены (входные / выходные)
   - Общая стоимость

2. **Таблица по этапам**:
   | Этап | Модель | Время | Токены | Стоимость |
   |------|--------|-------|--------|-----------|
   | Парсинг | — | — | — | — |
   | Транскрипция | large-v3-turbo | 23с | — | — |
   | Очистка | claude-sonnet-4-5 | 20с | 23K/2K | $0.10 |
   | ... | | | | |
   | **Итого** | | **1м 45с** | **62K/7K** | **$0.28** |

3. **Список созданных файлов** (опционально)

### Интеграция

- **StepByStep.tsx**: вкладка появляется после сохранения, автопереключение
- **ArchiveResultsModal.tsx**: вкладка доступна при наличии данных

### API унификация (v0.58+)

Для унификации структур данных между backend и frontend:

1. Добавлен `CamelCaseModel` в `schemas.py`:
   ```python
   class CamelCaseModel(BaseModel):
       model_config = ConfigDict(
           alias_generator=to_camel,
           populate_by_name=True,
       )
   ```

2. Все модели результатов наследуют от `CamelCaseModel`

3. API возвращает camelCase JSON:
   ```json
   {
     "createdAt": "2026-01-23T...",
     "rawTranscript": {...},
     "cleanedTranscript": {...}
   }
   ```

4. `pipeline_results.json` сохраняется в camelCase

## Последствия

### Преимущества

- Единое место для всех метрик
- Упрощённый `CompletionCard` (только файлы)
- Унифицированные типы frontend/backend
- Удобный анализ стоимости обработки

### Ограничения

- Старые `pipeline_results.json` в snake_case могут требовать миграции
- Добавлена зависимость от нового формата данных

## Связанные ADR

- [ADR-009: Extended Metrics](009-extended-metrics.md) — метрики в моделях
- [ADR-010: Slides Integration](010-slides-integration.md) — слайды в статистике
