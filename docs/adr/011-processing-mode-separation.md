# ADR-011: Разделение режимов обработки на отдельные компоненты

- **Статус:** Принято
- **Дата:** 2025-01-23
- **Версия:** v0.56

## Контекст

Изначально оба режима обработки (автоматический и пошаговый) использовали один компонент `StepByStep.tsx` с флагом `autoRun`. Это привело к проблемам:

1. **Раздутый компонент** — много условной логики `if (autoRun) ... else ...`
2. **Разные требования к UI:**
   - Автоматический режим: компактность, только прогресс, минимум деталей
   - Пошаговый режим: split view, просмотр результатов, настройки моделей/промптов
3. **Сложность поддержки** — изменения для одного режима ломали другой
4. **Размер модалки** — автоматический режим не требует полноэкранной модалки

## Решение

Разделить на два компонента с общим хуком для логики:

```
ProcessingModal
├── mode === 'auto' → AutoProcessingCompact (md modal, ~280px)
└── mode === 'step' → StepByStep (full modal, split view)
        │
        └── usePipelineProcessor (shared hook)
            • State management
            • Step execution
            • Progress tracking
            • Auto-run logic
```

### Новые файлы

| Файл | Назначение |
|------|------------|
| `hooks/usePipelineProcessor.ts` | Общая логика pipeline |
| `processing/AutoProcessingCompact.tsx` | Компактный UI для auto режима |

### Изменённые файлы

| Файл | Изменения |
|------|-----------|
| `processing/StepByStep.tsx` | Использует хук, удалён autoRun код |
| `processing/ProcessingModal.tsx` | Ветвление по mode, разный размер модалки |
| `App.tsx` | Добавлен `onOpenArchive` callback |

## Альтернативы

### 1. Оставить один компонент с условной логикой
**Отклонено:** Компонент становится слишком сложным, нарушается SRP.

### 2. Два полностью независимых компонента
**Отклонено:** Дублирование логики pipeline (step hooks, state, execution).

### 3. Выбранный вариант: общий хук + разные UI компоненты
**Принято:** Баланс между переиспользованием и разделением ответственности.

## Последствия

### Положительные

- **Чистый код** — каждый компонент отвечает за свой UI
- **Компактный auto режим** — модалка 448px вместо 1100px
- **Проще тестирование** — хук можно тестировать отдельно
- **Меньше bundle** — с 384 KB до 372 KB (-12 KB)

### Отрицательные

- **Три файла вместо одного** — больше файлов для навигации
- **Синхронизация** — при добавлении шага нужно проверить оба компонента

## Условия для пересмотра

- Появление третьего режима обработки
- Значительное усложнение логики хука
- Необходимость разных pipeline для разных режимов
