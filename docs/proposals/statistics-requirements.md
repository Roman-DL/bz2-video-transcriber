# Требования по доработке отображения статистики обработки

## Обзор

Данный документ описывает изменения в UI для отображения статистики расходов на LLM-обработку файлов. Основная цель — улучшить UX реализовав доступ к детальной статистике.

## Принципы

1. **Статистика по запросу** — итоговые расходы показываются только на финальном шаге
2. **Психологический комфорт** — пользователь фокусируется на качестве результата, а не на стоимости
3. **Консистентность** — одинаковое отображение в пошаговом режиме и при просмотре архива
4. **Детализация доступна** — полная информация по этапам на отдельной вкладке

---

## Изменения в пошаговой обработке

### 1. Блок успешного сохранения (левая панель)

**Было:**
- Список файлов
- Общее время
- Токены (вх./вых.)
- Стоимость
- Кнопка "Закрыть"

**Стало:**
- Компактный заголовок "Успешно сохранено" + количество файлов
- Только список файлов (компактный, scrollable max-height: 128px)
- Кнопка "Закрыть"

**Убрано из блока:**
- ❌ Общее время
- ❌ Токены (вх./вых.)
- ❌ Стоимость

### 2. Timeline этапов (левая панель)

**После завершения сохранения:**
- Шаг "Сохранение в архив" отмечается как **текущий** (не completed)
- Все предыдущие шаги отмечены как completed
- Badge "ТЕКУЩИЙ" на шаге сохранения

### 3. Автопереключение на вкладку "Статистика"

**После успешного сохранения:**
- Автоматически активируется вкладка "Статистика"
- Пользователь видит итоговую сводку как финальный результат

### 4. Вкладка "Статистика" (новая)

**Добавляется в конец списка вкладок:**
```
[Метаданные] [Транскрипт] [Очистка] [Слайды] [Лонгрид] [Конспект] [Чанки] [Статистика]
```

**Стилизация таба:**
- Цвет: violet (отличается от остальных blue)
- Иконка: BarChart3

---

## Содержимое вкладки "Статистика"

### Структура

```
┌──────────────────────────────────────────────────────────────┐
│ [📊] Статистика обработки                                    │
│      📅 2026-01-22 14:35:22                                  │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐          │
│  │ ⏱ Общее время │ │ ✨ Токены   │ │ 💰 Стоимость │          │
│  │    1м 45с    │ │ 62K / 6.8K   │ │    $0.28     │          │
│  └──────────────┘ └──────────────┘ └──────────────┘          │
│                                                              │
│  Детализация по этапам                                       │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │ Этап           │ Модель          │ Время │ Токены │ $.  │ │
│  ├─────────────────────────────────────────────────────────┤ │
│  │ Парсинг        │ —               │ 0.1с  │ —      │ —   │ │
│  │ Транскрипция   │ 🖥 large-v3-turbo│ 23с   │ —      │ —   │ │
│  │ Очистка        │ ☁ claude-sonnet │ 20с   │ 23K/1.8K│$0.10│ │
│  │ Слайды         │ ☁ claude-haiku  │ 7с    │ 1.9K/490│$0.00│ │
│  │ Лонгрид        │ ☁ claude-sonnet │ 35с   │ 28K/3.2K│$0.13│ │
│  │ Конспект       │ ☁ claude-sonnet │ 18с   │ 8.4K/1.2K│$0.04││
│  │ Чанки          │ —               │ 0.2с  │ —       │ —   │ │
│  │ Сохранение     │ —               │ 1.2с  │ —       │ —   │ │
│  ├──────────────────────────────────────────────────────────┤ │
│  │ ИТОГО          │                 │ 1м 45с│ 62K/6.8K│$0.28│ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                               │
│  Созданные файлы                                              │
│  ┌─────────────────────┐ ┌─────────────────────┐              │
│  │ 📄 pipeline.json    │ │ 📄 chunks.json      │               │
│  │ 📄 longread.md      │ │ 📄 summary.md       │               │
│  │ 📄 raw.txt          │ │ 📄 cleaned.txt      │               │
│  │ 📄 slides.md        │ │ 🎵 audio.mp3         │               │
│  └─────────────────────┘ └─────────────────────┘               │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

### Компоненты

#### Summary Cards (3 карточки)
| Карточка | Иконка | Цвет фона | Содержимое |
|----------|--------|-----------|------------|
| Общее время | Clock | blue-50 → indigo-50 | `{totalTime}` |
| Токены | Sparkles | violet-50 → purple-50 | `{input} вх. / {output} вых.` |
| Стоимость | Coins | emerald-50 → teal-50 | `${cost}` |

#### Таблица детализации
| Колонка | Выравнивание | Формат |
|---------|--------------|--------|
| Этап | left | Иконка + название |
| Модель | left | ☁/🖥 + mono name |
| Время | right | emerald color |
| Токены | right | mono, `input / output` |
| Стоимость | right | violet color, `$X.XX` |

**Footer таблицы (ИТОГО):**
- Фон: stone-100
- Border-top: 2px
- Font-weight: semibold

#### Список файлов (если не потребует изменение формата сохранения)
- Layout: grid 2 columns
- Элемент: иконка File + mono filename + size (справа, muted)
- Фон элемента: stone-50

---

## Изменения в просмотре архива

### Модальное окно архивной записи

**Добавить вкладку "Статистика":**
- Позиция: последняя в списке табов
- Содержимое: идентично пошаговой форме
- При открытии: активна первая вкладка (Метаданные), не статистика

Это обеспечивает консистентность с пошаговой формой и даёт контекстную информацию.

---

## Цветовая схема

### Вкладка "Статистика"
```css
/* Tab inactive */
text-stone-500 hover:text-stone-700 hover:bg-stone-50

/* Tab active */
text-violet-600 bg-violet-50 border-violet-200
```

### Summary Cards
```css
/* Время */
from-blue-50 to-indigo-50 border-blue-100
text-blue-600

/* Токены */
from-violet-50 to-purple-50 border-violet-100
text-violet-600

/* Стоимость */
from-emerald-50 to-teal-50 border-emerald-100
text-emerald-600
```

### Таблица
```css
/* Header */
bg-stone-50 text-stone-500 uppercase text-xs

/* Row hover */
hover:bg-stone-50/50

/* Cloud model badge */
text-violet-500

/* Local model badge */
text-emerald-500

/* Time value */
text-emerald-600

/* Cost value */
text-violet-600 font-semibold

/* Footer row */
bg-stone-100 border-t-2 border-stone-200 font-semibold
```

---

## Данные для статистики

### Источник данных
```typescript
interface ProcessingStats {
  processedAt: string;        // ISO datetime
  totalTime: string;          // "1м 45с"
  totals: {
    inputTokens: number;
    outputTokens: number;
    cost: number;             // USD
  };
  steps: Array<{
    id: string;
    name: string;
    icon: string;
    time: string;
    model: string | null;
    modelType: 'cloud' | 'local' | null;
    tokens: { input: number; output: number } | null;
    cost: number | null;
  }>;
  files: Array<{
    name: string;
    size: string;
  }>;
}
```

### Формат стоимости
```javascript
function formatCost(cost) {
  if (!cost) return '—';
  if (cost < 0.01) return `$${cost.toFixed(4)}`;
  return `$${cost.toFixed(2)}`;
}
```

---

## Приоритет реализации

1. **Высокий:** Вкладка "Статистика" в пошаговой форме
2. **Высокий:** Компактный блок успешного сохранения
3. **Высокий:** Автопереключение на статистику после сохранения
4. **Средний:** Вкладка "Статистика" в просмотре архива
5. **Низкий:** Анимация переключения на статистику

---

## Референсы

- `statistics-tab-prototype.jsx` — прототип вкладки статистики
