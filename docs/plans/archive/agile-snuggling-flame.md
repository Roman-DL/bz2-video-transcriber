# План: Редизайн UI пошаговой обработки

## Терминология (согласовано)

| Термин | Значение | Пример |
|--------|----------|--------|
| **Прошедшие этапы** | Завершённые шаги | Parse, Transcribe, Clean |
| **Текущий этап** | Последний прошедший (можно перезапустить) | Clean |
| **Следующий этап** | Ближайший будущий | Longread |

## Выбранное решение: Split-View "Editorial Processing Suite"

### Архитектура layout

```
┌─────────────────────────────────────────────────────────────────┐
│ Header: Пошаговая обработка • filename.mp3          [Отменить] │
├──────────────────────┬──────────────────────────────────────────┤
│                      │                                          │
│  LEFT PANEL (340px)  │  RIGHT PANEL (flexible)                  │
│  Pipeline Control    │  Results Viewer                          │
│                      │                                          │
│  ┌────────────────┐  │  ┌─ Tabs ─────────────────────────────┐  │
│  │ СЛЕДУЮЩИЙ ШАГ │  │  │ [Парсинг][Транскр][Очистка]...    │  │
│  │ Генерация...  │  │  └────────────────────────────────────┘  │
│  │ [▶ Выполнить] │  │                                          │
│  └────────────────┘  │  ┌─ Content ─────────────────────────┐  │
│                      │  │                                    │  │
│  Этапы обработки     │  │  Scrollable content area           │  │
│  ✓ 1. Парсинг        │  │  for large texts (longread,        │  │
│  ✓ 2. Транскрипция   │  │  summary, chunks)                  │  │
│  ✓ 3. Очистка [🔄]   │  │                                    │  │
│    └─ Настройки...   │  │                                    │  │
│  → 4. Лонгрид        │  │                                    │  │
│  ○ 5. Конспект       │  │                                    │  │
│  ○ 6. Чанки          │  │                                    │  │
│  ○ 7. Сохранение     │  │                                    │  │
│                      │  └────────────────────────────────────┘  │
└──────────────────────┴──────────────────────────────────────────┘
```

### Ключевые решения

1. **Split-view**: Фиксированная высота, левая панель для управления, правая для результатов
2. **Вертикальный stepper**: Все этапы видны с названиями и иконками
3. **Табы результатов**: Переключение между выходами без вертикального стека
4. **Контент-просмотрщик**: Полноценная scrollable область для больших текстов

### Визуальный стиль "Editorial"

- **Playfair Display**: Заголовки (серифный, изысканный)
- **Source Sans 3**: Основной текст (чистый, читаемый)
- **JetBrains Mono**: Технические элементы
- **Тёплая палитра**: Кремовый фон (#faf9f7), не стерильный белый
- **Subtle textures**: Градиенты, тени с намерением

---

## Режим автоматической обработки (autoRun=true)

### Отличия от пошагового режима

| Элемент | Step-by-step | Auto-run |
|---------|--------------|----------|
| Right panel (результаты) | ✓ Показывать | ✗ Скрыть |
| Кнопка "Выполнить" | ✓ Показывать | ✗ Скрыть |
| Кнопка "Перезапустить" | ✓ Показывать | ✗ Скрыть |
| Настройки этапа | ✓ Показывать | ✗ Скрыть |
| Клик по завершённым этапам | ✓ Работает | ✗ Отключён |
| Progress bar в карточке | При загрузке | При загрузке |

### Layout для auto-run

```
┌─────────────────────────────────────────────────────────────────┐
│ Header: Автоматическая обработка • filename.mp3     [Прервать] │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│                    SINGLE COLUMN (centered)                     │
│                    max-width: 480px                             │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ⟳ ВЫПОЛНЯЕТСЯ                                           │   │
│  │ Шаг 4 из 7: Генерация лонгрида                          │   │
│  │ Создание структурированного текста из транскрипции...   │   │
│  │                                                          │   │
│  │ ████████████░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░  45%          │   │
│  │                                          ~2 мин 30 сек   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  Этапы обработки                                                │
│  ──────────────────────────────────────────────                 │
│  ✓ 1. Парсинг метаданных                                        │
│  ✓ 2. Транскрипция                    ✓ 5:01                    │
│  ✓ 3. Очистка текста                  ✓ 4 282 симв.             │
│  ⟳ 4. Генерация лонгрида              ← выполняется             │
│  ○ 5. Генерация конспекта                                       │
│  ○ 6. Чанкирование                                              │
│  ○ 7. Сохранение                                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Ключевые особенности auto-run

1. **Одноколоночный layout**: Центрированный, без правой панели результатов
2. **Карточка текущего шага**: Показывает прогресс, описание, ETA
3. **Компактный stepper**: Без кнопок действий, только статус
4. **Краткая статистика**: Рядом с завершёнными шагами (длительность, размер)
5. **Анимация**: Spinning icon на текущем шаге

### Состояние завершения (auto-run)

```
┌─────────────────────────────────────────────────────────────────┐
│ Header: Обработка завершена • filename.mp3          [Закрыть]  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ✓ УСПЕШНО СОХРАНЕНО                                     │   │
│  │                                                          │   │
│  │ Файлы сохранены в архив:                                 │   │
│  │ • longread.md                                            │   │
│  │ • summary.md                                             │   │
│  │ • transcript.txt                                         │   │
│  │ • chunks.json                                            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  Этапы обработки                                                │
│  ──────────────────────────────────────────────                 │
│  ✓ 1. Парсинг метаданных              ✓                         │
│  ✓ 2. Транскрипция                    ✓ 5:01                    │
│  ✓ 3. Очистка текста                  ✓ 4 282 симв.             │
│  ✓ 4. Генерация лонгрида              ✓ 12 секций               │
│  ✓ 5. Генерация конспекта             ✓ 8 тезисов               │
│  ✓ 6. Чанкирование                    ✓ 12 чанков               │
│  ✓ 7. Сохранение                      ✓ 4 файла                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Файлы для изменения

| Файл | Изменения |
|------|-----------|
| [StepByStep.tsx](frontend/src/components/processing/StepByStep.tsx) | Полная переработка компонента |
| [index.css](frontend/src/index.css) | Добавить Google Fonts (Playfair Display, Source Sans 3, JetBrains Mono) |

## План реализации

1. **Создать базовый layout** с CSS variables и grid structure
2. **Реализовать Left Panel** (вертикальный stepper + карточка следующего шага)
3. **Реализовать Right Panel** (табы + контент-просмотрщик)
4. **Добавить auto-run режим** (одноколоночный layout)
5. **Интегрировать с существующей логикой** (hooks, state)
6. **Тестирование** обоих режимов

## Верификация

1. `cd frontend && npm run dev`
2. Открыть пошаговую обработку файла
3. Проверить:
   - [ ] Split-view layout работает
   - [ ] Вертикальный stepper показывает все этапы с названиями
   - [ ] Табы результатов переключаются
   - [ ] Большие тексты удобно читать в правой панели
   - [ ] Auto-run режим использует одноколоночный layout
   - [ ] Прогресс отображается корректно
