# Web UI — БЗ2 Транскрибатор

Веб-интерфейс для управления транскрипцией видеозаписей.

## Технологии

| Технология | Назначение |
|------------|------------|
| React 18 + TypeScript | Основа UI |
| Vite | Сборка и dev-сервер |
| TanStack Query | Кэширование API запросов |
| Tailwind CSS v4 | Стилизация |
| Axios | HTTP клиент |
| lucide-react | Иконки |

## Dashboard

```
┌─────────────────────────────────────────────────────────────────┐
│  БЗ2 Транскрибатор            [● Whisper] [● Ollama]            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────┐  ┌─────────────────────────┐   │
│  │  Inbox (3 видео)        [↻] │  │  Задачи (2)             │   │
│  │  ┌─────────────────────────┐│  │  ┌─────────────────────┐│   │
│  │  │ 📹 Группа поддержки  [▶]││  │  │ [████████░░] 65%    ││   │
│  │  │ 📹 Работа с возр.    [▶]││  │  │ Очистка текста...   ││   │
│  │  │ 📹 Первые шаги       [▶]││  │  ├─────────────────────┤│   │
│  │  └─────────────────────────┘│  │  │ ✓ Завершено (вчера) ││   │
│  └─────────────────────────────┘  │  └─────────────────────┘│   │
│                                   └─────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

## Режимы обработки

При клике на "Обработать" открывается модальное окно с выбором режима:

| Режим | Описание |
|-------|----------|
| **Полный pipeline** | Автоматически все 6 этапов, прогресс через WebSocket |
| **Пошаговый** | Выполнение этапов по одному с просмотром результатов |

### Полный pipeline

- Запускает все 6 этапов последовательно
- Прогресс отображается в реальном времени через WebSocket
- Подходит для production использования

### Пошаговый режим

Предназначен для тестирования промптов и отладки:

```
┌─────────────────────────────────────────────────────────────────┐
│  Пошаговая обработка: video.mp4                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Шаги: [✓]──[✓]──[●]──[○]──[○]──[○]                            │
│         1    2    3    4    5    6                              │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  Шаг 3: Очистка текста                   [Выполнить →]  │    │
│  │  Очистка текста с использованием глоссария и LLM        │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
│  Результаты:                                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  Метаданные                                              │    │
│  │  Дата: 2025-01-09 | Поток: ПШ.SV | Спикер: Иванова      │    │
│  ├─────────────────────────────────────────────────────────┤    │
│  │  Сырая транскрипция (45 мин, 1247 сегментов)            │    │
│  │  [00:00:00] Добрый день, коллеги...                     │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

Позволяет:
- Выполнять каждый этап отдельно
- Просматривать результаты между этапами
- Отлаживать промпты для очистки, chunking и саммаризации

## Структура компонентов

```
frontend/src/components/
├── layout/          # Header, Layout
├── common/          # Button, Card, Badge, ProgressBar, Spinner, Modal
├── services/        # ServiceStatus (Whisper/Ollama индикаторы)
├── inbox/           # InboxList, VideoItem
├── jobs/            # JobList, JobCard
├── processing/      # ProcessingModal, FullPipeline, StepByStep
└── results/         # MetadataView, TranscriptView, ChunksView, SummaryView
```

## API интеграция

### Hooks (TanStack Query)

| Hook | Назначение |
|------|------------|
| `useInbox` | Список видео в inbox |
| `useJobs` | Список задач обработки |
| `useServices` | Статус AI сервисов |
| `useProcess` | Запуск обработки |
| `useSteps` | Пошаговый режим |

### WebSocket

Прогресс обработки в реальном времени через `/ws/{job_id}`:

```typescript
// Формат сообщения
{
  "job_id": "abc123",
  "status": "processing",
  "progress": 65,
  "stage": "clean",
  "message": "Очистка текста..."
}
```

## Разработка

### Локальный запуск

```bash
cd frontend
npm install
npm run dev
```

Dev-сервер запускается на http://localhost:5173 с proxy на backend (через Tailscale):

```typescript
// vite.config.ts
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://100.64.0.1:8801',
        changeOrigin: true
      },
      '/ws': {
        target: 'ws://100.64.0.1:8801',
        ws: true
      },
      '/health': {
        target: 'http://100.64.0.1:8801',
        changeOrigin: true
      }
    }
  }
})
```

### Production сборка

```bash
npm run build
```

Собранные файлы раздаются через nginx (см. [deployment.md](deployment.md)).

## Связанные документы

- [architecture.md](architecture.md) — техническая архитектура
- [pipeline/08-api.md](pipeline/08-api.md) — API endpoints
- [deployment.md](deployment.md) — развёртывание
