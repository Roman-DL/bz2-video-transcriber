# Этап 6: Summarize (Генерация конспекта)

[< Назад: Longread](05-longread.md) | [Обзор Pipeline](README.md) | [Далее: Save >](07-save.md)

---

## Назначение

Создание структурированного конспекта (2-4 страницы) из лонгрида для быстрого ознакомления с содержанием видео.

Конспект — это выжимка ключевой информации:
- Суть видео в 2-3 предложениях
- Основные концепции и термины
- Практические инструменты и техники
- Цитаты спикера
- Инсайты и рекомендации к действию

## Архитектура

Конспект генерируется из лонгрида одним LLM-запросом:

```
Longread (5-10 страниц)
       │
       ▼
┌─────────────────────────┐
│   SummaryGenerator      │  → Один LLM-запрос
│   (summary.md prompt)   │
└────────────┬────────────┘
             │
             ▼
         Summary
```

**Почему из лонгрида, а не из транскрипта:**
- Лонгрид уже структурирован и очищен
- Меньше токенов на вход (~3-5K вместо ~50K)
- Выше качество — LLM работает с готовым текстом, а не с устной речью
- Быстрее — один запрос вместо map-reduce

## Модель данных: Summary

| Поле | Тип | Описание |
|------|-----|----------|
| video_id | str | ID видео |
| title | str | Название |
| speaker | str | Спикер |
| date | date | Дата |
| duration | str | Длительность |
| essence | str | Суть видео (2-3 предложения) |
| key_concepts | list[str] | Ключевые концепции |
| practical_tools | list[str] | Практические инструменты |
| quotes | list[str] | Цитаты спикера |
| insight | str | Главный инсайт |
| actions | list[str] | Рекомендации к действию |
| section | str | Раздел БЗ |
| subsection | str | Подраздел |
| tags | list[str] | Теги |
| access_level | int | Уровень доступа (1-4) |

## Формат выходного файла

Конспект сохраняется как `summary.md` в формате Obsidian с callouts:

```markdown
---
title: Мастер-класс по питанию
speaker: Иван Петров
date: 2025-01-15
duration: "01:23:45"
section: Обучение
subsection: Питание
tags: [белки, жиры, углеводы]
access_level: 1
type: summary
---

# Мастер-класс по питанию

> Спикер: Иван Петров | Дата: 15 января 2025 | Длительность: 1:23:45

> [!abstract] Суть
> Краткое описание содержания видео в 2-3 предложениях.

> [!info] Ключевые концепции
> - Концепция 1 — описание
> - Концепция 2 — описание

> [!tip] Практические инструменты
> - Инструмент 1
> - Инструмент 2

> [!quote] Цитаты
> - "Цитата спикера 1"
> - "Цитата спикера 2"

> [!success] Главный инсайт
> Ключевая мысль из видео.

> [!todo] К действию
> - [ ] Действие 1
> - [ ] Действие 2
```

## Классификация

### Секции БЗ

| Секция | Описание |
|--------|----------|
| Обучение | Методики, техники, навыки, тренинги |
| Продукты | Продукция Herbalife, применение, результаты |
| Бизнес | Построение бизнеса, рекрутинг, продажи |
| Мотивация | Истории успеха, вдохновение, личностный рост |

### Уровни доступа

| Уровень | Аудитория |
|---------|-----------|
| 1 | Все консультанты |
| 2 | Спонсоры |
| 3 | TAB Team |
| 4 | Администраторы |

## Конфигурация

Параметры в `config/models.yaml`:

```yaml
defaults:
  summary:
    max_input_chars: 50000

models:
  qwen2.5:14b:
    summary:
      max_input_chars: 60000
```

## Промпт

Основной промпт: `config/prompts/summary.md`

Поддерживаются версии для моделей:
- `summary_qwen2.5:14b.md`
- `summary_gemma2:9b.md`

## Step-by-step режим

В режиме `/api/steps/summarize`:
1. Принимает готовый лонгрид
2. Генерирует конспект
3. Возвращает без сохранения

## Оценка времени

| Входные данные | Время |
|----------------|-------|
| Лонгрид ~5000 слов | ~30-60 сек |
| Лонгрид ~10000 слов | ~1-2 мин |

---

## Связанные файлы

- **Сервис:** `backend/app/services/summary_generator.py`
- **Модели:** `backend/app/models/schemas.py` → `Summary`
- **Промпт:** `config/prompts/summary.md`
- **Конфигурация:** `config/models.yaml` → `summary`
