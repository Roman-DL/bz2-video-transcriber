# Refactor CLAUDE.md

Рефакторинг CLAUDE.md: вынос правил в модульную структуру `.claude/rules/`.

## Когда запускать

- Файл > 250 строк
- Много специфичных правил для разных частей кода
- Сложно найти нужную инструкцию

## Выполнить

### 1. Анализ текущего состояния

```bash
wc -l CLAUDE.md
ls -la .claude/rules/
```

Показать текущий размер CLAUDE.md и список существующих rules.

### 2. Маршрутизация контента

Для каждого правила/ограничения в CLAUDE.md определи куда оно должно попасть:

| Тип контента | Куда | Пример |
|-------------|------|--------|
| Описание проекта | CLAUDE.md | "Telegram-бот для консультантов" |
| Команды запуска | CLAUDE.md | Секция "Быстрый старт" |
| Workflow разработки | CLAUDE.md | /preflight → реализация → /finalize |
| Навигация по docs/ | CLAUDE.md | Таблицы документации |
| Общие ограничения | CLAUDE.md | "НИКОГДА не использовать pkill -f" |
| **Правила модуля** | **Существующий rule** | "Хэндлеры не содержат бизнес-логику" → `bot-handlers.md` |
| **Правила нового модуля** | **Новый rule** | Правила для RAG → `rag.md` с globs |

### 3. Разнести по правилам

**Если rule для модуля уже существует:**
- Добавь правило в соответствующую секцию существующего файла
- НЕ создавай новый rule-файл

**Если rule для модуля НЕ существует:**
- Создай новый файл в `.claude/rules/` с globs

```markdown
---
globs: src/module/**
---

# Правила: Module Name

## Категория
- Правило (директивное: "делай X", "НЕ делай Y")
- Код-пример (минимальный)
```

### 4. Обновить CLAUDE.md

- Удалить вынесенные правила
- Проверить что < 300 строк
- НЕ добавлять ссылки на конкретные rules (они загружаются автоматически по globs)

### 5. Проверить результат

```bash
wc -l CLAUDE.md
ls -la .claude/rules/
```

## Критерии успеха

- [ ] CLAUDE.md < 300 строк
- [ ] Критичные общие ограничения остались в CLAUDE.md
- [ ] Модульные правила в `.claude/rules/` (с globs)
- [ ] Нет дублирования между CLAUDE.md и rules
- [ ] Нет дублирования между разными rule-файлами

## Что НЕ выносить из CLAUDE.md

- Описание проекта и стека
- Команды запуска/тестов
- Навигацию по документации
- Текущий статус и структуру проекта
- Workflow (/preflight → /finalize)
- 2-3 критичных ограничения (про pkill, про сложность)

## Что НЕ класть в rules

- Описательную документацию ("система устроена так") → `docs/`
- Архитектурные решения ("почему так") → `docs/decisions/`
- Rules — это **директивы** ("делай так"), не документация

---

_Команда: /refactor-claude_
